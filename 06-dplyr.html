<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Introduction to R for Geospatial Data: Data frame Manipulation with dplyr</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav data"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Data Carpentry" src="assets/images/data-logo.svg"></div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/06-dplyr.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav data" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Data Carpentry" src="assets/images/data-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Introduction to R for Geospatial Data
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Introduction to R for Geospatial Data
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="discuss.html">Discussion</a></li><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Introduction to R for Geospatial Data
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 67%" class="percentage">
    67%
  </div>
  <div class="progress data">
    <div class="progress-bar data" role="progressbar" style="width: 67%" aria-valuenow="67" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/06-dplyr.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-rstudio-intro.html">1. Introduction to R and RStudio</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-project-intro.html">2. Project Management With RStudio</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-data-structures-part1.html">3. Data Structures</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="05-data-subsetting.html">4. Subsetting Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Data frame Manipulation with dplyr
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#the-dplyr-package">The <code>dplyr</code> package</a></li>
<li><a href="#using-select">Using <code>select()</code></a></li>
<li><a href="#the-pipe">The Pipe</a></li>
<li><a href="#using-filter">Using <code>filter()</code></a></li>
<li><a href="#using-group_by-and-summarize">Using <code>group_by()</code> and <code>summarize()</code></a></li>
<li><a href="#using-summarize">Using <code>summarize()</code></a></li>
<li><a href="#count-and-n"><code>count()</code> and <code>n()</code></a></li>
<li><a href="#using-mutate">Using <code>mutate()</code></a></li>
<li><a href="#using-mutate-and-group_by-together">Using <code>mutate()</code> and <code>group_by()</code>
together</a></li>
<li><a href="#other-great-resources">Other great resources</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="07-plot-ggplot2.html">6. Introduction to Visualization</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="08-writing-data.html">7. Writing Data</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="discuss.html">Discussion</a></li><li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-data-subsetting.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-plot-ggplot2.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-data-subsetting.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Subsetting Data
        </a>
        <a class="chapter-link float-end" href="07-plot-ggplot2.html" rel="next">
          Next: Introduction to... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Data frame Manipulation with dplyr</h1>
        <p>Last updated on 2024-01-10 |
        
        <a href="https://github.com/datacarpentry/r-intro-geospatial/edit/main/episodes/06-dplyr.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I manipulate dataframes without repeating myself?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>To be able to use the six main dataframe manipulation ‘verbs’ with
pipes in <code>dplyr</code>.</li>
<li>To understand how <code>group_by()</code> and
<code>summarize()</code> can be combined to summarize datasets.</li>
<li>Be able to analyze a subset of data using logical filtering.</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>Let’s begin by loading the Maine DMR kelp-urchin data for the whole
coastline.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">&lt;-</span> <span class="fu">read.csv</span><span class="op">(</span><span class="st">"data/dmr_kelp_urchin.csv"</span><span class="op">)</span> </span></code></pre>
</div>
<p>Manipulation of dataframes means many things to many researchers. We
often select certain observations (rows) or variables (columns), we
often group the data by a certain variable(s), or we even calculate new
variables or summary statistics. We can do these operations using the
base R operations we’ve already learned:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">dmr</span><span class="op">[</span><span class="va">dmr</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2001</span>, <span class="st">"kelp"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 41.36417</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">dmr</span><span class="op">[</span><span class="va">dmr</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2008</span>, <span class="st">"kelp"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 55.89091</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">mean</span><span class="op">(</span><span class="va">dmr</span><span class="op">[</span><span class="va">dmr</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2014</span>, <span class="st">"kelp"</span><span class="op">]</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 39.21705</code></pre>
</div>
<p>But this isn’t very efficient, and can become tedious quickly because
there is a fair bit of repetition. Repeating yourself will cost you
time, both now and later, and potentially introduce some nasty bugs.</p>
<section id="the-dplyr-package"><h2 class="section-heading">The <code>dplyr</code> package<a class="anchor" aria-label="anchor" href="#the-dplyr-package"></a>
</h2>
<hr class="half-width"><p>Luckily, the <a href="https://dplyr.tidyverse.org" class="external-link"><code>dplyr</code></a> package
provides a number of very useful functions for manipulating dataframes
in a way that will reduce the above repetition, reduce the probability
of making errors, and probably even save you some typing. As an added
bonus, you might even find the <code>dplyr</code> grammar easier to
read.</p>
<p>Here we’re going to cover 6 of the most commonly used functions as
well as using pipes (<code>|&gt;</code>) to combine them.</p>
<ol style="list-style-type: decimal"><li><code>select()</code></li>
<li><code>filter()</code></li>
<li><code>group_by()</code></li>
<li><code>summarize()</code></li>
<li>
<code>count()</code> and <code>n()</code>
</li>
<li><code>mutate()</code></li>
</ol><p>If you have have not installed this package earlier, please do
so:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">install.packages</span><span class="op">(</span><span class="st">'dplyr'</span><span class="op">)</span></span></code></pre>
</div>
<p>Now let’s load the package:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="st">"dplyr"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="using-select"><h2 class="section-heading">Using <code>select()</code><a class="anchor" aria-label="anchor" href="#using-select"></a>
</h2>
<hr class="half-width"><p>If, for example, we wanted to move forward with only a few of the
variables in our dataframe we could use the <code>select()</code>
function. This will keep only the variables you select.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr_kelp</span> <span class="op">&lt;-</span> <span class="fu">select</span><span class="op">(</span><span class="va">dmr</span>, <span class="va">year</span>, <span class="va">region</span>, <span class="va">kelp</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="fig/13-dplyr-fig1.png" alt="Illustration of selecting two columns from a dataframe" class="figure mx-auto d-block"></figure><p>If we examine <code>dmr_kelp</code> we’ll see that it only contains
the year, region and kelp columns.</p>
</section><section id="the-pipe"><h2 class="section-heading">The Pipe<a class="anchor" aria-label="anchor" href="#the-pipe"></a>
</h2>
<hr class="half-width"><p>Above we used ‘normal’ grammar, but the strengths of
<code>dplyr</code> lie in combining several functions using pipes. Since
the pipes grammar is unlike anything we’ve seen in R before, let’s
repeat what we’ve done above using pipes.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr_kelp</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span> <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">region</span>, <span class="va">kelp</span><span class="op">)</span></span></code></pre>
</div>
<p>To help you understand why we wrote that in that way, let’s walk
through it step by step. First we summon the <code>dmr</code> data frame
and pass it on, using the pipe symbol <code>|&gt;</code>, to the next
step, which is the <code>select()</code> function. In this case we don’t
specify which data object we use in the <code>select()</code> function
since in gets that from the previous pipe. Pipes can be used for more
than just <code>dplyr</code> functions. For example, what if we wanted
the unique region names in <code>dmr</code>?</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span> <span class="op">|&gt;</span> <span class="fu">unique</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "York"          "Casco Bay"     "Midcoast"      "Penobscot Bay"
[5] "MDI"           "Downeast"     </code></pre>
</div>
<p>We can also chain pipes together. What if we wanted those unique
region names sorted?</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span> <span class="op">|&gt;</span> <span class="fu">unique</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "Casco Bay"     "Downeast"      "MDI"           "Midcoast"     
[5] "Penobscot Bay" "York"         </code></pre>
</div>
<p>To make our code more readable when we chain operations together, we
often separate each step onto its own line of code.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unique</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>This has the secondary benefit that if you’re puzzing through a
particularly difficult workflow, you can write it out in comments with
one step on each line, and then figure out what functions to use. Like
as follows</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#----</span></span>
<span><span class="co"># Step 1: write our what you want to do</span></span>
<span></span>
<span><span class="co"># start with regions</span></span>
<span>  <span class="co"># get the unique values</span></span>
<span>  <span class="co"># sort them</span></span>
<span></span>
<span></span>
<span><span class="co">#----</span></span>
<span><span class="co"># Step 2. fill in the first bit</span></span>
<span></span>
<span><span class="co"># start with regions</span></span>
<span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span></span>
<span>  <span class="co"># get the unique values</span></span>
<span>  <span class="co"># sort them</span></span>
<span></span>
<span><span class="co">#----</span></span>
<span><span class="co"># Step 3. fill in the second step after looking up ??unique</span></span>
<span></span>
<span><span class="co"># start with regions</span></span>
<span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># get the unique values</span></span>
<span>  <span class="fu">unique</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># sort them</span></span>
<span></span>
<span><span class="co">#----</span></span>
<span><span class="co"># Step 4. Bring it home after googling "how to make alphabetical in R"</span></span>
<span></span>
<span><span class="co"># start with regions</span></span>
<span><span class="va">dmr</span><span class="op">$</span><span class="va">region</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># get the unique values</span></span>
<span>  <span class="fu">unique</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="co"># sort them</span></span>
<span>  <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p><strong>Fun Fact</strong>: You may have encountered pipes before in
other programming contexts. In R, a pipe symbol is <code>|&gt;</code>
while in other contexts it is often <code>|</code> but the concept is
the same!</p>
<p>The <code>|&gt;</code> operator is relatively new in R as part of the
base language. But, the use of pipes has been around for longer.
<code>dplyr</code> and many <code>tidyverse</code> libraries adopted the
pipe from the <a href="https://magrittr.tidyverse.org/" class="external-link">magrittr</a>
library Danish data scientist Stefan Milton Bache and first released in
2014. You might see <code>%&gt;%</code> in code from experienced R uses
who still use the older style pipe. There are some subtle differences
between the two, but for what we will be doing, <code>|&gt;</code> will
work just fine. Also, Hadley Wickham (the original author of dplyr and
much of the tidyverse who popularized <code>%&gt;%</code>) is <a href="https://twitter.com/hadleywickham/status/1519313737773158401" class="external-link">pro-base-pipe</a>.</p>
</div>
</div>
</div>
</section><section id="using-filter"><h2 class="section-heading">Using <code>filter()</code><a class="anchor" aria-label="anchor" href="#using-filter"></a>
</h2>
<hr class="half-width"><p>Just as <code>select</code> subsets columns, <code>filter</code>
subsets rows using logical arguments. If we now wanted to move forward
with the above, but only with data from 2011 and kelp data, we can
combine <code>select</code> and <code>filter</code></p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr_2011</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2011</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">select</span><span class="op">(</span><span class="va">year</span>, <span class="va">region</span>, <span class="va">kelp</span><span class="op">)</span></span></code></pre>
</div>
<div id="challenge-1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-1" class="callout-inner">
<h3 class="callout-title">Challenge 1<a class="anchor" aria-label="anchor" href="#challenge-1"></a>
</h3>
<div class="callout-content">
<p>Write a single command (which can span multiple lines and includes
pipes) that will produce a dataframe that has the Midcoast values for
<code>kelp</code>, <code>urchin</code> and <code>year</code>, but not
for other regions. How many rows does your dataframe have and why?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Solution to Challenge 1</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">year_kelp_urchin_dmr</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>                           <span class="fu">filter</span><span class="op">(</span><span class="va">region</span><span class="op">==</span><span class="st">"Midcoast"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>                           <span class="fu">select</span><span class="op">(</span><span class="va">year</span>,<span class="va">kelp</span>,<span class="va">urchin</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">nrow</span><span class="op">(</span><span class="va">year_kelp_urchin_dmr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 249</code></pre>
</div>
<p>249 rows, as they are only the Midcoast samples</p>
</div>
</div>
</div>
</div>
<p>As with last time, first we pass the dmr dataframe to the
<code>filter()</code> function, then we pass the filtered version of the
dmr data frame to the <code>select()</code> function.
<strong>Note:</strong> The order of operations is very important in this
case. If we used ‘select’ first, filter would not be able to find the
variable region since we would have removed it in the previous step.</p>
<p>We could now do some specific operations (like calculating summary
statistics) on just the Midcoast region.</p>
</section><section id="using-group_by-and-summarize"><h2 class="section-heading">Using <code>group_by()</code> and <code>summarize()</code><a class="anchor" aria-label="anchor" href="#using-group_by-and-summarize"></a>
</h2>
<hr class="half-width"><p>However, we were supposed to be reducing the error prone
repetitiveness of what can be done with base R! If we wanted to do
something for each region, we could take the above approach but we would
have to repeat for each region. Instead of <code>filter()</code>, which
will only pass observations that meet your criteria (in the above:
<code>region</code>==“Midcoast”<code>), we can use</code>group_by()`,
which will essentially use every unique criteria that you could have
used in filter.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">class</span><span class="op">(</span><span class="va">dmr</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "data.frame"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">class</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "grouped_df" "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<p>You will notice that the structure of the dataframe where we used
<code>group_by()</code> (<code>grouped_df</code>) is not the same as the
original <code>dmr</code> (<code>data.frame</code>). A
<code>grouped_df</code> can be thought of as a <code>list</code> where
each item in the <code>list</code>is a <code>data.frame</code> which
contains only the rows that correspond to the a particular value
<code>continent</code> (at least in the example above).</p>
<figure><img src="fig/13-dplyr-fig2.png" alt="Illustration of multiple dataframes created by piping a dataframe to group_by" class="figure mx-auto d-block"></figure><p>To see this more explicitly, try <code>str()</code> and see the
information about groups at the end.</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">str</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>gropd_df [1,478 × 15] (S3: grouped_df/tbl_df/tbl/data.frame)
 $ year         : int [1:1478] 2001 2001 2001 2001 2001 2001 2001 2001 2001 2001 ...
 $ region       : chr [1:1478] "York" "York" "York" "York" ...
 $ exposure.code: int [1:1478] 4 4 4 4 4 2 2 3 2 2 ...
 $ coastal.code : int [1:1478] 3 3 3 4 3 2 2 3 2 2 ...
 $ latitude     : num [1:1478] 43.1 43.3 43.4 43.5 43.5 ...
 $ longitude    : num [1:1478] -70.7 -70.6 -70.4 -70.3 -70.3 ...
 $ depth        : int [1:1478] 5 5 5 5 5 5 5 5 5 5 ...
 $ crust        : num [1:1478] 60 75.5 73.5 63.5 72.5 6.1 31.5 31.5 40.5 53 ...
 $ understory   : num [1:1478] 100 100 80 82 69 38.5 74 96.5 60 59.5 ...
 $ kelp         : num [1:1478] 1.9 0 18.5 0.6 63.5 92.5 59 7.7 52.5 29.2 ...
 $ urchin       : num [1:1478] 0 0 0 0 0 0 0 0 0 0 ...
 $ month        : int [1:1478] 6 6 6 6 6 6 6 6 6 6 ...
 $ day          : int [1:1478] 13 13 14 14 14 15 15 15 8 8 ...
 $ survey       : chr [1:1478] "dmr" "dmr" "dmr" "dmr" ...
 $ site         : int [1:1478] 42 47 56 61 62 66 71 70 23 22 ...
 - attr(*, "groups")= tibble [6 × 2] (S3: tbl_df/tbl/data.frame)
  ..$ region: chr [1:6] "Casco Bay" "Downeast" "MDI" "Midcoast" ...
  ..$ .rows : list&lt;int&gt; [1:6] 
  .. ..$ : int [1:90] 6 7 8 9 10 11 12 92 93 94 ...
  .. ..$ : int [1:483] 65 66 67 68 69 70 71 72 73 74 ...
  .. ..$ : int [1:342] 44 45 46 47 48 49 50 51 52 53 ...
  .. ..$ : int [1:249] 13 14 15 16 17 18 19 20 21 22 ...
  .. ..$ : int [1:272] 32 33 34 35 36 37 38 39 40 41 ...
  .. ..$ : int [1:42] 1 2 3 4 5 90 91 170 171 172 ...
  .. ..@ ptype: int(0) 
  ..- attr(*, ".drop")= logi TRUE</code></pre>
</div>
</section><section id="using-summarize"><h2 class="section-heading">Using <code>summarize()</code><a class="anchor" aria-label="anchor" href="#using-summarize"></a>
</h2>
<hr class="half-width"><p>The above was a bit on the uneventful side but
<code>group_by()</code> is much more exciting in conjunction with
<code>summarize()</code>. This will allow us to create new variable(s)
by using functions that repeat for each of the continent-specific data
frames. That is to say, using the <code>group_by()</code> function, we
split our original dataframe into multiple pieces, then we can run
functions (e.g. <code>mean()</code> or <code>sd()</code>) within
<code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kelp_by_region</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_kelp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">kelp_by_region</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 2
  region        mean_kelp
  &lt;chr&gt;             &lt;dbl&gt;
1 Casco Bay          44.1
2 Downeast           67.0
3 MDI                46.9
4 Midcoast           40.5
5 Penobscot Bay      41.1
6 York               19.4</code></pre>
</div>
<figure><img src="fig/13-dplyr-fig3.png" alt="illustration of creating a summary dataframe from grouped data" class="figure mx-auto d-block"></figure><p>That allowed us to calculate the mean kelp % cover for each region,
but it gets even better.</p>
<div id="challenge-2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-2" class="callout-inner">
<h3 class="callout-title">Challenge 2<a class="anchor" aria-label="anchor" href="#challenge-2"></a>
</h3>
<div class="callout-content">
<p>Calculate the average urchin abundance per region. Which region has
the most urchins on average and which has the least?</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Solution to Challenge 2</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urchin_by_region</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">summarize</span><span class="op">(</span>mean_urchins <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">urchin</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">urchin_by_region</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">filter</span><span class="op">(</span><span class="va">mean_urchins</span> <span class="op">==</span> <span class="fu">min</span><span class="op">(</span><span class="va">mean_urchins</span><span class="op">)</span> <span class="op">|</span> <span class="va">mean_urchins</span> <span class="op">==</span> <span class="fu">max</span><span class="op">(</span><span class="va">mean_urchins</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 2 × 2
  region        mean_urchins
  &lt;chr&gt;                &lt;dbl&gt;
1 Casco Bay           0.0767
2 Penobscot Bay       5.30  </code></pre>
</div>
<p>Another way to do this is to use the <code>dplyr</code> function
<code>arrange()</code>, which arranges the rows in a data frame
according to the order of one or more variables from the data frame. It
has similar syntax to other functions from the <code>dplyr</code>
package. You can use <code>desc()</code> inside <code>arrange()</code>
to sort in descending order.</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urchin_by_region</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="va">mean_urchins</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  region    mean_urchins
  &lt;chr&gt;            &lt;dbl&gt;
1 Casco Bay       0.0767</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">urchin_by_region</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">mean_urchins</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>   <span class="fu">head</span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1 × 2
  region        mean_urchins
  &lt;chr&gt;                &lt;dbl&gt;
1 Penobscot Bay         5.30</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The function <code>group_by()</code> allows us to group by multiple
variables. Let’s group by <code>year</code> and <code>region</code>.</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kelp_region_year</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_kelp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>`summarise()` has grouped output by 'region'. You can override using the
`.groups` argument.</code></pre>
</div>
<p>That is already quite powerful, but it gets even better! You’re not
limited to defining 1 new variable in <code>summarize()</code>.</p>
<div class="codewrapper sourceCode" id="cb37">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">kelp_urchin_region_year</span> <span class="op">&lt;-</span> <span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span>, <span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">summarize</span><span class="op">(</span>mean_kelp <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span>,</span>
<span>            mean_urchin <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">urchin</span><span class="op">)</span>,</span>
<span>            sd_kelp <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span>,</span>
<span>            sd_urchin <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">urchin</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="count-and-n"><h2 class="section-heading">
<code>count()</code> and <code>n()</code><a class="anchor" aria-label="anchor" href="#count-and-n"></a>
</h2>
<hr class="half-width"><p>A very common operation is to count the number of observations for
each group. The <code>dplyr</code> package comes with two related
functions that help with this.</p>
<p>For instance, if we wanted to check the number of countries included
in the dataset for the year 2002, we can use the <code>count()</code>
function. It takes the name of one or more columns that contain the
groups we are interested in, and we can optionally sort the results in
descending order by adding <code>sort=TRUE</code>:</p>
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2002</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">count</span><span class="op">(</span><span class="va">region</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>         region  n
1      Downeast 25
2           MDI 17
3 Penobscot Bay 15
4      Midcoast 13
5     Casco Bay  8
6          York  2</code></pre>
</div>
<p>If we need to use the number of observations in calculations, the
<code>n()</code> function is useful. For instance, if we wanted to get
the standard error of urchins per region:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">summarize</span><span class="op">(</span>se_urchin <span class="op">=</span> <span class="fu">sd</span><span class="op">(</span><span class="va">urchin</span><span class="op">)</span><span class="op">/</span><span class="fu">sqrt</span><span class="op">(</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 2
  region        se_urchin
  &lt;chr&gt;             &lt;dbl&gt;
1 Casco Bay        0.0392
2 Downeast         0.303 
3 MDI              0.388 
4 Midcoast         0.227 
5 Penobscot Bay    0.659 
6 York             0.788 </code></pre>
</div>
</section><section id="using-mutate"><h2 class="section-heading">Using <code>mutate()</code><a class="anchor" aria-label="anchor" href="#using-mutate"></a>
</h2>
<hr class="half-width"><p>We can also create new variables prior to (or even after) summarizing
information using <code>mutate()</code>. For example, if we wanted to
create a <code>total_fleshy_algae</code> column.</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>total_fleshy_algae <span class="op">=</span> <span class="va">kelp</span> <span class="op">+</span> <span class="va">understory</span><span class="op">)</span></span></code></pre>
</div>
<p>You can also create a second new column based on the first new column
within the same call of <code>mutate()</code>:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>total_fleshy_algae <span class="op">=</span> <span class="va">kelp</span> <span class="op">+</span> <span class="va">understory</span>,</span>
<span>         total_algae <span class="op">=</span> <span class="va">total_fleshy_algae</span> <span class="op">+</span> <span class="va">crust</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="using-mutate-and-group_by-together"><h2 class="section-heading">Using <code>mutate()</code> and <code>group_by()</code>
together<a class="anchor" aria-label="anchor" href="#using-mutate-and-group_by-together"></a>
</h2>
<hr class="half-width"><p>In some cases, you might want to use <code>mutate()</code> in
conjunction with <code>group_by()</code> to get summarized properties
for groups, but not lose your original data. for example, let’s say we
wanted to calculate how kelp differed from average conditions within a
region each year. This is called an anomaly. In essence we want to get
the average amount of kelp in a region over time, and then calculate a
<code>kelp_anomaly_regional</code> where we subtract the amount of kelp
from the regional average over time. This makes it easier to separate
regional variation from variation over time.</p>
<p>This requires putting <code>mutate()</code> and
<code>group_by()</code> together.</p>
<div class="codewrapper sourceCode" id="cb44">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mean_kelp_regional <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span>,</span>
<span>         kelp_anomaly_regional <span class="op">=</span> <span class="va">kelp</span> <span class="op">-</span> <span class="va">mean_kelp_regional</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 1,478 × 17
# Groups:   region [6]
    year region    exposure.code coastal.code latitude longitude depth crust
   &lt;int&gt; &lt;chr&gt;             &lt;int&gt;        &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
 1  2001 York                  4            3     43.1     -70.7     5  60  
 2  2001 York                  4            3     43.3     -70.6     5  75.5
 3  2001 York                  4            3     43.4     -70.4     5  73.5
 4  2001 York                  4            4     43.5     -70.3     5  63.5
 5  2001 York                  4            3     43.5     -70.3     5  72.5
 6  2001 Casco Bay             2            2     43.7     -70.1     5   6.1
 7  2001 Casco Bay             2            2     43.8     -70.0     5  31.5
 8  2001 Casco Bay             3            3     43.8     -69.9     5  31.5
 9  2001 Casco Bay             2            2     43.8     -69.9     5  40.5
10  2001 Casco Bay             2            2     43.8     -69.9     5  53  
# ℹ 1,468 more rows
# ℹ 9 more variables: understory &lt;dbl&gt;, kelp &lt;dbl&gt;, urchin &lt;dbl&gt;, month &lt;int&gt;,
#   day &lt;int&gt;, survey &lt;chr&gt;, site &lt;int&gt;, mean_kelp_regional &lt;dbl&gt;,
#   kelp_anomaly_regional &lt;dbl&gt;</code></pre>
</div>
<p>This worked, but, uh oh. Why is the data frame still grouped? Leaving
a data frame grouped will have consequences, as any other mutate will be
done <strong>by region</strong> instead of on the whole data frame. So,
for example, if we wanted to then get a <em>global</em> anomaly, i.e.,
the difference between kelp and the average amount of kelp for the
entire data set, we couldn’t just do another set of mutates.</p>
<p>Fortunately, we can resolve this with <code>ungroup()</code>: a
useful verb to insert any time you want to remove all grouping
structure, and are worried <code>dplyr</code> is not doing it for
you.</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dmr</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">region</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>mean_kelp_regional <span class="op">=</span> <span class="fu">mean</span><span class="op">(</span><span class="va">kelp</span><span class="op">)</span>,</span>
<span>         kelp_anomaly_regional <span class="op">=</span> <span class="va">kelp</span> <span class="op">-</span> <span class="va">mean_kelp_regional</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code># A tibble: 6 × 17
   year region    exposure.code coastal.code latitude longitude depth crust
  &lt;int&gt; &lt;chr&gt;             &lt;int&gt;        &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
1  2001 York                  4            3     43.1     -70.7     5  60  
2  2001 York                  4            3     43.3     -70.6     5  75.5
3  2001 York                  4            3     43.4     -70.4     5  73.5
4  2001 York                  4            4     43.5     -70.3     5  63.5
5  2001 York                  4            3     43.5     -70.3     5  72.5
6  2001 Casco Bay             2            2     43.7     -70.1     5   6.1
# ℹ 9 more variables: understory &lt;dbl&gt;, kelp &lt;dbl&gt;, urchin &lt;dbl&gt;, month &lt;int&gt;,
#   day &lt;int&gt;, survey &lt;chr&gt;, site &lt;int&gt;, mean_kelp_regional &lt;dbl&gt;,
#   kelp_anomaly_regional &lt;dbl&gt;</code></pre>
</div>
<p>Note, it does convert your data frame into a <code>tibble</code> (a
“tidy” data frame), but if you really want a data frame back, you can
use <code>as.data.frame()</code>.</p>
<!-- 
:::::::::::::::::::::::::::::::::::::::  challenge

## Extra Challenge 4

Let's look at interannual and spatial variability a bit. Calculate the urchin 
anomaly by `year` and `exposure.code` (1 is fully protected from the open 
ocean, 5 is fully exposed). To figure out the most variable year and exposure,
calculate the difference between the biggest anomaly and smallest anomaly by 
year and exposure. What year and exposure code had the biggest difference?

One way to start this is to write out in comments what you want to do

```
# start with data
# group by year and exposure.code
# calculate urchin anomaly
# summarize min and max anomaly
# calculate difference between the two
# get the row with the biggest difference
```

:::::::::::::::  solution

## Solution to Challenge 2


```r
dmr |> 
  
  group_by(year, exposure.code) |>
  
  mutate(mean_urchins_exposure_year = mean(urchin),
         urchin_anomaly_exposure_year = urchin - mean_urchins_exposure_year) |>
  
  summarize(max_anomaly = max(urchin_anomaly_exposure_year),
            min_anomaly = min(urchin_anomaly_exposure_year),
            diff = max_anomaly - min_anomaly) |>

  ungroup() |>
  
  filter(diff == max(diff))
```

```{.output}
`summarise()` has grouped output by 'year'. You can override using the
`.groups` argument.
```

```{.output}
# A tibble: 1 × 5
   year exposure.code max_anomaly min_anomaly  diff
  <int>         <int>       <dbl>       <dbl> <dbl>
1  2010             1        79.1       -14.8  93.9
```


:::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::::::::::::::::

-->
</section><section id="other-great-resources"><h2 class="section-heading">Other great resources<a class="anchor" aria-label="anchor" href="#other-great-resources"></a>
</h2>
<hr class="half-width"><ul><li><a href="https://r4ds.had.co.nz/" class="external-link">R for Data Science</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf" class="external-link">Data
Wrangling Cheat sheet</a></li>
<li><a href="https://cran.r-project.org/web/packages/dplyr/vignettes/dplyr.html" class="external-link">Introduction
to dplyr</a></li>
<li><a href="https://www.rstudio.com/resources/webinars/data-wrangling-with-r-and-rstudio/" class="external-link">Data
wrangling with R and RStudio</a></li>
</ul><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use the <code>dplyr</code> package to manipulate dataframes.</li>
<li>Use <code>select()</code> to choose variables from a dataframe.</li>
<li>Use <code>filter()</code> to choose data based on values.</li>
<li>Use <code>group_by()</code> and <code>summarize()</code> to work
with subsets of data.</li>
<li>Use <code>count()</code> and <code>n()</code> to obtain the number
of observations in columns.</li>
<li>Use <code>mutate()</code> to create new variables.</li>
</ul></div>
</div>
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="05-data-subsetting.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="07-plot-ggplot2.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="05-data-subsetting.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Subsetting Data
        </a>
        <a class="chapter-link float-end" href="07-plot-ggplot2.html" rel="next">
          Next: Introduction to... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/datacarpentry/r-intro-geospatial/edit/main/episodes/06-dplyr.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/datacarpentry/r-intro-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/datacarpentry/r-intro-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/datacarpentry/r-intro-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:team@carpentries.org">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://datacarpentry.github.io/r-intro-geospatial/06-dplyr.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Data frame Manipulation with dplyr",
  "creativeWorkStatus": "active",
  "url": "https://datacarpentry.github.io/r-intro-geospatial/06-dplyr.html",
  "identifier": "https://datacarpentry.github.io/r-intro-geospatial/06-dplyr.html",
  "dateCreated": "2018-04-05",
  "dateModified": "2024-01-10",
  "datePublished": "2024-01-16"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

